app = "enigma-erp-saas"
kill_signal = "SIGINT"
kill_timeout = 5
primary_region = "sin" # Recommended: Singapore for Asia-based users
processes = []

[build]
  image = "frappe/erpnext:v15"

[env]
  # CRUCIAL: Memory Optimization Hack for 256MB RAM (must be <= 200)
  NODE_OPTIONS = "--max-old-space-size=200"
  
  # TiDB CLUSTER 0 (Main SaaS Management Core)
  DB_HOST = "gateway01.ap-northeast-1.prod.aws.tidbcloud.com"
  DB_PORT = "4000"
  DB_USER = "2TRMpH74KNVgkaU.root"
  DB_PASSWORD = "Q9s3ehpqHhODlEDC"
  DB_NAME = "enigma_core"
  DB_TYPE = "mysql" # TiDB uses MySQL protocol

  # ERPNext Configuration
  SITE_NAME = "erp.enigmamarketing.pk"
  FRAPPE_PATH = "/home/frappe/frappe-bench/apps/frappe"
  CORS_ALLOWED_METHODS = "GET, POST, OPTIONS, PUT, DELETE"
  WORKERS = 2 # Reduced for low RAM
  # Ensures the server listens correctly
  PORT = "8000"

[mounts]
  source="erpnext_data"
  destination="/home/frappe/frappe-bench/sites"

[metrics]
  port = 9091
  path = "/metrics"

[[services]]
  http_checks = []
  internal_port = 8000
  processes = ["app"]
  protocol = "tcp"
  [services.ports]
    port = 80
    handlers = ["http"]
  [services.ports]
    port = 443
    handlers = ["tls", "http"]
  [services.tcp_checks]
    interval = "15s"
    timeout = "2s"